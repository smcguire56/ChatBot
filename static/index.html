<!DOCTYPE html>
<html lang="en">

<head>
	<title>Chat Bot</title>
	<meta charset="utf-8">
	<meta name="description" content="Go web Application">
	<meta name="keywords" content="HTML,CSS,go,eliza,bob">
	<meta name="author" content="Sean McGuire">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
	<!-- Bootstrap CSS -->
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
	<link href="styles.css" rel="stylesheet" type="text/css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
</head>

<body>
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">Bob Ross Chat Bot</a>
			</div>
		</div>
	</nav>
	<div class="myContainer">
		<div class="col-sm-8 col-sm-offset-3 frame">
			<div class="container-fluid">
				<ul class="scrollable"></ul>
				<div>
					<div class="text text-r" style="background:rgba(245, 245, 245, 0.33) !important">
						<input class="mytext" id="mytext" placeholder="Type a message">
					</div>
				</div>
				<div class="checkbox"></div>
				<h5 class="container">Text to Speech.</h5><input data-toggle="toggle" id="textToSpeech" type="checkbox">
			</div>
		</div>
	</div>

	<script type="text/javascript">
		var name;
		var me = {};
		me.avatar = "img/person.png";
		var you = {};
		you.avatar = "img/bob.jpeg";

		function formatAMPM(date) {
			var hours = date.getHours();
			var minutes = date.getMinutes();
			var ampm = hours >= 12 ? 'PM' : 'AM';
			hours = hours % 12;
			hours = hours ? hours : 12; // the hour '0' should be '12'
			minutes = minutes < 10 ? '0' + minutes : minutes;
			var strTime = hours + ':' + minutes + ' ' + ampm;
			return strTime;
		}

		//-- No use time. It is a javaScript effect.
		function insertChat(who, text, time = 0) {
			var control = "";
			var date = formatAMPM(new Date());

			if (who == "me") {
				control = '<li style="width:100%">' +
					'<div class="msj macro">' +
					'<div class="avatar"><img class="img-circle" style="width:100%;" src="' + me.avatar +
					'" /><\/div>' +
					'<div class="text text-l">' +
					'<p>' + name + '<\/p>' +
					'<p class="text-left">' + text + '<\/p>' +
					'<p><small>' + date + '<\/small><\/p>' +
					'<\/div>' +
					'<\/div>' +
					'<\/li>';
			} else {
				control = '<li style="width:100%;">' +
					'<div class="msj-rta macro">' +
					'<div class="text text-r">' +
					'<p class="text-right">Bob<\/p>' +
					'<p class="text-right">' + text + '<\/p>' +
					'<p><small>' + date + '<\/small><\/p>' +
					'<\/div>' +
					'<div class="avatar" style="padding:0px 0px 0px 10px !important"><img class="img-circle" style="width:100%;" src="' +
					you.avatar + '" /><\/div>' +
					'<\/li>';
			}
			setTimeout(
				function () {
					$("ul").append(control);
					$("ul").animate({
						scrollTop: $("ul")[0].scrollHeight
					}, 500);
				}, time);

		}

		function resetChat() {
			$("ul").empty();
		}

		$(".mytext").on("keyup", function (e) {
			if (e.which == 13) {
				var text = $(this).val();
				if (text !== "") {
					insertChat("me", text);
					$(this).val('');
				}
			}
		});

		//-- Clear Chat
		resetChat();

		//-- Print Messages
		var firstMessage = 0;
		insertChat("you", "Hello, What is your name?", 0);

		function addtxt() {
			if (firstMessage == 0) {
				name = document.getElementById("mytext").value;
				insertChat("you", "Hello " + name + ", What do you want to talk about?", 500);

				firstMessage++;
			} else // normal messages
			{
				var xhttp = new XMLHttpRequest();

				xhttp.onreadystatechange = function () {
					if (this.readyState == 4 && this.status == 200) {
						insertChat("you", xhttp.responseText, 500);
						if ($('#textToSpeech').prop('checked')) {
							var msg = new SpeechSynthesisUtterance(xhttp.responseText);
							msg.pitch = 0.3; //0 to 2
							window.speechSynthesis.speak(msg);
						}
					}
				};

				xhttp.open("POST", "elizaRequests", true);
				xhttp.setRequestHeader("Cache-Control", "no-cache");
				xhttp.setRequestHeader("sendInput", document.getElementById("mytext").value);

				xhttp.send();
			}
		}

		$(document).keypress(function (e) {
			if (e.which == 13) {
				addtxt();
			}
		});
	</script>
</body>

</html>